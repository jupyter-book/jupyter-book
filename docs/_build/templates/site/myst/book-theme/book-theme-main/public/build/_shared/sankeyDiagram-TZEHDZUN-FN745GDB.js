import{K as vt,M as wt,P as bt,Q as St,R as Mt,S as Lt,T as At,U as Et,V as Nt,W as Q,Y as Tt}from"/myst_assets_folder/_shared/chunk-JU57NILB.js";import{b as m,j as Y,o as Ct,s as Ot}from"/myst_assets_folder/_shared/chunk-7DW7L33J.js";import"/myst_assets_folder/_shared/chunk-KQM5FBHR.js";import"/myst_assets_folder/_shared/chunk-OZE3FFNP.js";var at=Math.PI,lt=2*at,F=1e-6,Ut=lt-F;function ut(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function It(){return new ut}ut.prototype=It.prototype={constructor:ut,moveTo:function(t,e){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(t,e){this._+="L"+(this._x1=+t)+","+(this._y1=+e)},quadraticCurveTo:function(t,e,s,i){this._+="Q"+ +t+","+ +e+","+(this._x1=+s)+","+(this._y1=+i)},bezierCurveTo:function(t,e,s,i,r,c){this._+="C"+ +t+","+ +e+","+ +s+","+ +i+","+(this._x1=+r)+","+(this._y1=+c)},arcTo:function(t,e,s,i,r){t=+t,e=+e,s=+s,i=+i,r=+r;var c=this._x1,g=this._y1,k=s-t,o=i-e,l=c-t,u=g-e,_=l*l+u*u;if(r<0)throw new Error("negative radius: "+r);if(this._x1===null)this._+="M"+(this._x1=t)+","+(this._y1=e);else if(_>F)if(!(Math.abs(u*k-o*l)>F)||!r)this._+="L"+(this._x1=t)+","+(this._y1=e);else{var v=s-c,d=i-g,w=k*k+o*o,N=v*v+d*d,E=Math.sqrt(w),T=Math.sqrt(_),P=r*Math.tan((at-Math.acos((w+_-N)/(2*E*T)))/2),R=P/T,B=P/E;Math.abs(R-1)>F&&(this._+="L"+(t+R*l)+","+(e+R*u)),this._+="A"+r+","+r+",0,0,"+ +(u*v>l*d)+","+(this._x1=t+B*k)+","+(this._y1=e+B*o)}},arc:function(t,e,s,i,r,c){t=+t,e=+e,s=+s,c=!!c;var g=s*Math.cos(i),k=s*Math.sin(i),o=t+g,l=e+k,u=1^c,_=c?i-r:r-i;if(s<0)throw new Error("negative radius: "+s);this._x1===null?this._+="M"+o+","+l:(Math.abs(this._x1-o)>F||Math.abs(this._y1-l)>F)&&(this._+="L"+o+","+l),s&&(_<0&&(_=_%lt+lt),_>Ut?this._+="A"+s+","+s+",0,1,"+u+","+(t-g)+","+(e-k)+"A"+s+","+s+",0,1,"+u+","+(this._x1=o)+","+(this._y1=l):_>F&&(this._+="A"+s+","+s+",0,"+ +(_>=at)+","+u+","+(this._x1=t+s*Math.cos(r))+","+(this._y1=e+s*Math.sin(r))))},rect:function(t,e,s,i){this._+="M"+(this._x0=this._x1=+t)+","+(this._y0=this._y1=+e)+"h"+ +s+"v"+ +i+"h"+-s+"Z"},toString:function(){return this._}};var ft=It;function V(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function ct(t){return t.length===1&&(t=Ht(t)),{left:function(e,s,i,r){for(i==null&&(i=0),r==null&&(r=e.length);i<r;){var c=i+r>>>1;t(e[c],s)<0?i=c+1:r=c}return i},right:function(e,s,i,r){for(i==null&&(i=0),r==null&&(r=e.length);i<r;){var c=i+r>>>1;t(e[c],s)>0?r=c:i=c+1}return i}}}function Ht(t){return function(e,s){return V(t(e),s)}}var Pt=ct(V),Yt=Pt.right,Xt=Pt.left;var zt=Array.prototype,Jt=zt.slice,Qt=zt.map;var en=Math.sqrt(50),nn=Math.sqrt(10),rn=Math.sqrt(2);function Z(t,e){var s=t.length,i=-1,r,c;if(e==null){for(;++i<s;)if((r=t[i])!=null&&r>=r)for(c=r;++i<s;)(r=t[i])!=null&&r>c&&(c=r)}else for(;++i<s;)if((r=e(t[i],i,t))!=null&&r>=r)for(c=r;++i<s;)(r=e(t[i],i,t))!=null&&r>c&&(c=r);return c}function q(t,e){var s=t.length,i=-1,r,c;if(e==null){for(;++i<s;)if((r=t[i])!=null&&r>=r)for(c=r;++i<s;)(r=t[i])!=null&&c>r&&(c=r)}else for(;++i<s;)if((r=e(t[i],i,t))!=null&&r>=r)for(c=r;++i<s;)(r=e(t[i],i,t))!=null&&c>r&&(c=r);return c}function X(t,e){var s=t.length,i=-1,r,c=0;if(e==null)for(;++i<s;)(r=+t[i])&&(c+=r);else for(;++i<s;)(r=+e(t[i],i,t))&&(c+=r);return c}function oe(t){return t.target.depth}function ht(t){return t.depth}function pt(t,e){return e-1-t.height}function G(t,e){return t.sourceLinks.length?t.depth:e-1}function dt(t){return t.targetLinks.length?t.depth:t.sourceLinks.length?q(t.sourceLinks,oe)-1:0}function W(t){return function(){return t}}function Dt(t,e){return tt(t.source,e.source)||t.index-e.index}function jt(t,e){return tt(t.target,e.target)||t.index-e.index}function tt(t,e){return t.y0-e.y0}function yt(t){return t.value}function se(t){return t.index}function ae(t){return t.nodes}function le(t){return t.links}function Bt(t,e){let s=t.get(e);if(!s)throw new Error("missing: "+e);return s}function $t({nodes:t}){for(let e of t){let s=e.y0,i=s;for(let r of e.sourceLinks)r.y0=s+r.width/2,s+=r.width;for(let r of e.targetLinks)r.y1=i+r.width/2,i+=r.width}}function et(){let t=0,e=0,s=1,i=1,r=24,c=8,g,k=se,o=G,l,u,_=ae,v=le,d=6;function w(){let n={nodes:_.apply(null,arguments),links:v.apply(null,arguments)};return N(n),E(n),T(n),P(n),D(n),$t(n),n}w.update=function(n){return $t(n),n},w.nodeId=function(n){return arguments.length?(k=typeof n=="function"?n:W(n),w):k},w.nodeAlign=function(n){return arguments.length?(o=typeof n=="function"?n:W(n),w):o},w.nodeSort=function(n){return arguments.length?(l=n,w):l},w.nodeWidth=function(n){return arguments.length?(r=+n,w):r},w.nodePadding=function(n){return arguments.length?(c=g=+n,w):c},w.nodes=function(n){return arguments.length?(_=typeof n=="function"?n:W(n),w):_},w.links=function(n){return arguments.length?(v=typeof n=="function"?n:W(n),w):v},w.linkSort=function(n){return arguments.length?(u=n,w):u},w.size=function(n){return arguments.length?(t=e=0,s=+n[0],i=+n[1],w):[s-t,i-e]},w.extent=function(n){return arguments.length?(t=+n[0][0],s=+n[1][0],e=+n[0][1],i=+n[1][1],w):[[t,e],[s,i]]},w.iterations=function(n){return arguments.length?(d=+n,w):d};function N({nodes:n,links:f}){for(let[p,a]of n.entries())a.index=p,a.sourceLinks=[],a.targetLinks=[];let h=new Map(n.map((p,a)=>[k(p,a,n),p]));for(let[p,a]of f.entries()){a.index=p;let{source:x,target:b}=a;typeof x!="object"&&(x=a.source=Bt(h,x)),typeof b!="object"&&(b=a.target=Bt(h,b)),x.sourceLinks.push(a),b.targetLinks.push(a)}if(u!=null)for(let{sourceLinks:p,targetLinks:a}of n)p.sort(u),a.sort(u)}function E({nodes:n}){for(let f of n)f.value=f.fixedValue===void 0?Math.max(X(f.sourceLinks,yt),X(f.targetLinks,yt)):f.fixedValue}function T({nodes:n}){let f=n.length,h=new Set(n),p=new Set,a=0;for(;h.size;){for(let x of h){x.depth=a;for(let{target:b}of x.sourceLinks)p.add(b)}if(++a>f)throw new Error("circular link");h=p,p=new Set}}function P({nodes:n}){let f=n.length,h=new Set(n),p=new Set,a=0;for(;h.size;){for(let x of h){x.height=a;for(let{source:b}of x.targetLinks)p.add(b)}if(++a>f)throw new Error("circular link");h=p,p=new Set}}function R({nodes:n}){let f=Z(n,a=>a.depth)+1,h=(s-t-r)/(f-1),p=new Array(f);for(let a of n){let x=Math.max(0,Math.min(f-1,Math.floor(o.call(null,a,f))));a.layer=x,a.x0=t+x*h,a.x1=a.x0+r,p[x]?p[x].push(a):p[x]=[a]}if(l)for(let a of p)a.sort(l);return p}function B(n){let f=q(n,h=>(i-e-(h.length-1)*g)/X(h,yt));for(let h of n){let p=e;for(let a of h){a.y0=p,a.y1=p+a.value*f,p=a.y1+g;for(let x of a.sourceLinks)x.width=x.value*f}p=(i-p+g)/(h.length+1);for(let a=0;a<h.length;++a){let x=h[a];x.y0+=p*(a+1),x.y1+=p*(a+1)}J(h)}}function D(n){let f=R(n);g=Math.min(c,(i-e)/(Z(f,h=>h.length)-1)),B(f);for(let h=0;h<d;++h){let p=Math.pow(.99,h),a=Math.max(1-p,(h+1)/d);C(f,p,a),S(f,p,a)}}function S(n,f,h){for(let p=1,a=n.length;p<a;++p){let x=n[p];for(let b of x){let $=0,I=0;for(let{source:M,value:st}of b.targetLinks){let H=st*(b.layer-M.layer);$+=L(M,b)*H,I+=H}if(!(I>0))continue;let j=($/I-b.y0)*f;b.y0+=j,b.y1+=j,A(b)}l===void 0&&x.sort(tt),z(x,h)}}function C(n,f,h){for(let p=n.length,a=p-2;a>=0;--a){let x=n[a];for(let b of x){let $=0,I=0;for(let{target:M,value:st}of b.sourceLinks){let H=st*(M.layer-b.layer);$+=U(b,M)*H,I+=H}if(!(I>0))continue;let j=($/I-b.y0)*f;b.y0+=j,b.y1+=j,A(b)}l===void 0&&x.sort(tt),z(x,h)}}function z(n,f){let h=n.length>>1,p=n[h];y(n,p.y0-g,h-1,f),O(n,p.y1+g,h+1,f),y(n,i,n.length-1,f),O(n,e,0,f)}function O(n,f,h,p){for(;h<n.length;++h){let a=n[h],x=(f-a.y0)*p;x>1e-6&&(a.y0+=x,a.y1+=x),f=a.y1+g}}function y(n,f,h,p){for(;h>=0;--h){let a=n[h],x=(a.y1-f)*p;x>1e-6&&(a.y0-=x,a.y1-=x),f=a.y0-g}}function A({sourceLinks:n,targetLinks:f}){if(u===void 0){for(let{source:{sourceLinks:h}}of f)h.sort(jt);for(let{target:{targetLinks:h}}of n)h.sort(Dt)}}function J(n){if(u===void 0)for(let{sourceLinks:f,targetLinks:h}of n)f.sort(jt),h.sort(Dt)}function L(n,f){let h=n.y0-(n.sourceLinks.length-1)*g/2;for(let{target:p,width:a}of n.sourceLinks){if(p===f)break;h+=a+g}for(let{source:p,width:a}of f.targetLinks){if(p===n)break;h-=a}return h}function U(n,f){let h=f.y0-(f.targetLinks.length-1)*g/2;for(let{source:p,width:a}of f.targetLinks){if(p===n)break;h+=a+g}for(let{target:p,width:a}of n.sourceLinks){if(p===f)break;h-=a}return h}return w}function mt(t){return function(){return t}}function Vt(t){return t[0]}function Ft(t){return t[1]}var qt=Array.prototype.slice;function ue(t){return t.source}function fe(t){return t.target}function ce(t){var e=ue,s=fe,i=Vt,r=Ft,c=null;function g(){var k,o=qt.call(arguments),l=e.apply(this,o),u=s.apply(this,o);if(c||(c=k=ft()),t(c,+i.apply(this,(o[0]=l,o)),+r.apply(this,o),+i.apply(this,(o[0]=u,o)),+r.apply(this,o)),k)return c=null,k+""||null}return g.source=function(k){return arguments.length?(e=k,g):e},g.target=function(k){return arguments.length?(s=k,g):s},g.x=function(k){return arguments.length?(i=typeof k=="function"?k:mt(+k),g):i},g.y=function(k){return arguments.length?(r=typeof k=="function"?k:mt(+k),g):r},g.context=function(k){return arguments.length?(c=k??null,g):c},g}function he(t,e,s,i,r){t.moveTo(e,s),t.bezierCurveTo(e=(e+i)/2,s,e,r,i,r)}function gt(){return ce(he)}function pe(t){return[t.source.x1,t.y0]}function de(t){return[t.target.x0,t.y1]}function xt(){return gt().source(pe).target(de)}var kt=function(){var t=m(function(k,o,l,u){for(l=l||{},u=k.length;u--;l[k[u]]=o);return l},"o"),e=[1,9],s=[1,10],i=[1,5,10,12],r={trace:m(function(){},"trace"),yy:{},symbols_:{error:2,start:3,SANKEY:4,NEWLINE:5,csv:6,opt_eof:7,record:8,csv_tail:9,EOF:10,"field[source]":11,COMMA:12,"field[target]":13,"field[value]":14,field:15,escaped:16,non_escaped:17,DQUOTE:18,ESCAPED_TEXT:19,NON_ESCAPED_TEXT:20,$accept:0,$end:1},terminals_:{2:"error",4:"SANKEY",5:"NEWLINE",10:"EOF",11:"field[source]",12:"COMMA",13:"field[target]",14:"field[value]",18:"DQUOTE",19:"ESCAPED_TEXT",20:"NON_ESCAPED_TEXT"},productions_:[0,[3,4],[6,2],[9,2],[9,0],[7,1],[7,0],[8,5],[15,1],[15,1],[16,3],[17,1]],performAction:m(function(o,l,u,_,v,d,w){var N=d.length-1;switch(v){case 7:let E=_.findOrCreateNode(d[N-4].trim().replaceAll('""','"')),T=_.findOrCreateNode(d[N-2].trim().replaceAll('""','"')),P=parseFloat(d[N].trim());_.addLink(E,T,P);break;case 8:case 9:case 11:this.$=d[N];break;case 10:this.$=d[N-1];break}},"anonymous"),table:[{3:1,4:[1,2]},{1:[3]},{5:[1,3]},{6:4,8:5,15:6,16:7,17:8,18:e,20:s},{1:[2,6],7:11,10:[1,12]},t(s,[2,4],{9:13,5:[1,14]}),{12:[1,15]},t(i,[2,8]),t(i,[2,9]),{19:[1,16]},t(i,[2,11]),{1:[2,1]},{1:[2,5]},t(s,[2,2]),{6:17,8:5,15:6,16:7,17:8,18:e,20:s},{15:18,16:7,17:8,18:e,20:s},{18:[1,19]},t(s,[2,3]),{12:[1,20]},t(i,[2,10]),{15:21,16:7,17:8,18:e,20:s},t([1,5,10],[2,7])],defaultActions:{11:[2,1],12:[2,5]},parseError:m(function(o,l){if(l.recoverable)this.trace(o);else{var u=new Error(o);throw u.hash=l,u}},"parseError"),parse:m(function(o){var l=this,u=[0],_=[],v=[null],d=[],w=this.table,N="",E=0,T=0,P=0,R=2,B=1,D=d.slice.call(arguments,1),S=Object.create(this.lexer),C={yy:{}};for(var z in this.yy)Object.prototype.hasOwnProperty.call(this.yy,z)&&(C.yy[z]=this.yy[z]);S.setInput(o,C.yy),C.yy.lexer=S,C.yy.parser=this,typeof S.yylloc>"u"&&(S.yylloc={});var O=S.yylloc;d.push(O);var y=S.options&&S.options.ranges;typeof C.yy.parseError=="function"?this.parseError=C.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;function A(M){u.length=u.length-2*M,v.length=v.length-M,d.length=d.length-M}m(A,"popStack");function J(){var M;return M=_.pop()||S.lex()||B,typeof M!="number"&&(M instanceof Array&&(_=M,M=_.pop()),M=l.symbols_[M]||M),M}m(J,"lex");for(var L,U,n,f,h,p,a={},x,b,$,I;;){if(n=u[u.length-1],this.defaultActions[n]?f=this.defaultActions[n]:((L===null||typeof L>"u")&&(L=J()),f=w[n]&&w[n][L]),typeof f>"u"||!f.length||!f[0]){var j="";I=[];for(x in w[n])this.terminals_[x]&&x>R&&I.push("'"+this.terminals_[x]+"'");S.showPosition?j="Parse error on line "+(E+1)+`:
`+S.showPosition()+`
Expecting `+I.join(", ")+", got '"+(this.terminals_[L]||L)+"'":j="Parse error on line "+(E+1)+": Unexpected "+(L==B?"end of input":"'"+(this.terminals_[L]||L)+"'"),this.parseError(j,{text:S.match,token:this.terminals_[L]||L,line:S.yylineno,loc:O,expected:I})}if(f[0]instanceof Array&&f.length>1)throw new Error("Parse Error: multiple actions possible at state: "+n+", token: "+L);switch(f[0]){case 1:u.push(L),v.push(S.yytext),d.push(S.yylloc),u.push(f[1]),L=null,U?(L=U,U=null):(T=S.yyleng,N=S.yytext,E=S.yylineno,O=S.yylloc,P>0&&P--);break;case 2:if(b=this.productions_[f[1]][1],a.$=v[v.length-b],a._$={first_line:d[d.length-(b||1)].first_line,last_line:d[d.length-1].last_line,first_column:d[d.length-(b||1)].first_column,last_column:d[d.length-1].last_column},y&&(a._$.range=[d[d.length-(b||1)].range[0],d[d.length-1].range[1]]),p=this.performAction.apply(a,[N,T,E,C.yy,f[1],v,d].concat(D)),typeof p<"u")return p;b&&(u=u.slice(0,-1*b*2),v=v.slice(0,-1*b),d=d.slice(0,-1*b)),u.push(this.productions_[f[1]][0]),v.push(a.$),d.push(a._$),$=w[u[u.length-2]][u[u.length-1]],u.push($);break;case 3:return!0}}return!0},"parse")},c=function(){var k={EOF:1,parseError:m(function(l,u){if(this.yy.parser)this.yy.parser.parseError(l,u);else throw new Error(l)},"parseError"),setInput:m(function(o,l){return this.yy=l||this.yy||{},this._input=o,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},"setInput"),input:m(function(){var o=this._input[0];this.yytext+=o,this.yyleng++,this.offset++,this.match+=o,this.matched+=o;var l=o.match(/(?:\r\n?|\n).*/g);return l?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),o},"input"),unput:m(function(o){var l=o.length,u=o.split(/(?:\r\n?|\n)/g);this._input=o+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-l),this.offset-=l;var _=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),u.length-1&&(this.yylineno-=u.length-1);var v=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:u?(u.length===_.length?this.yylloc.first_column:0)+_[_.length-u.length].length-u[0].length:this.yylloc.first_column-l},this.options.ranges&&(this.yylloc.range=[v[0],v[0]+this.yyleng-l]),this.yyleng=this.yytext.length,this},"unput"),more:m(function(){return this._more=!0,this},"more"),reject:m(function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+`. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).
`+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},"reject"),less:m(function(o){this.unput(this.match.slice(o))},"less"),pastInput:m(function(){var o=this.matched.substr(0,this.matched.length-this.match.length);return(o.length>20?"...":"")+o.substr(-20).replace(/\n/g,"")},"pastInput"),upcomingInput:m(function(){var o=this.match;return o.length<20&&(o+=this._input.substr(0,20-o.length)),(o.substr(0,20)+(o.length>20?"...":"")).replace(/\n/g,"")},"upcomingInput"),showPosition:m(function(){var o=this.pastInput(),l=new Array(o.length+1).join("-");return o+this.upcomingInput()+`
`+l+"^"},"showPosition"),test_match:m(function(o,l){var u,_,v;if(this.options.backtrack_lexer&&(v={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(v.yylloc.range=this.yylloc.range.slice(0))),_=o[0].match(/(?:\r\n?|\n).*/g),_&&(this.yylineno+=_.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:_?_[_.length-1].length-_[_.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+o[0].length},this.yytext+=o[0],this.match+=o[0],this.matches=o,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(o[0].length),this.matched+=o[0],u=this.performAction.call(this,this.yy,this,l,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),u)return u;if(this._backtrack){for(var d in v)this[d]=v[d];return!1}return!1},"test_match"),next:m(function(){if(this.done)return this.EOF;this._input||(this.done=!0);var o,l,u,_;this._more||(this.yytext="",this.match="");for(var v=this._currentRules(),d=0;d<v.length;d++)if(u=this._input.match(this.rules[v[d]]),u&&(!l||u[0].length>l[0].length)){if(l=u,_=d,this.options.backtrack_lexer){if(o=this.test_match(u,v[d]),o!==!1)return o;if(this._backtrack){l=!1;continue}else return!1}else if(!this.options.flex)break}return l?(o=this.test_match(l,v[_]),o!==!1?o:!1):this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+`. Unrecognized text.
`+this.showPosition(),{text:"",token:null,line:this.yylineno})},"next"),lex:m(function(){var l=this.next();return l||this.lex()},"lex"),begin:m(function(l){this.conditionStack.push(l)},"begin"),popState:m(function(){var l=this.conditionStack.length-1;return l>0?this.conditionStack.pop():this.conditionStack[0]},"popState"),_currentRules:m(function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},"_currentRules"),topState:m(function(l){return l=this.conditionStack.length-1-Math.abs(l||0),l>=0?this.conditionStack[l]:"INITIAL"},"topState"),pushState:m(function(l){this.begin(l)},"pushState"),stateStackSize:m(function(){return this.conditionStack.length},"stateStackSize"),options:{"case-insensitive":!0},performAction:m(function(l,u,_,v){var d=v;switch(_){case 0:return this.pushState("csv"),4;break;case 1:return this.pushState("csv"),4;break;case 2:return 10;case 3:return 5;case 4:return 12;case 5:return this.pushState("escaped_text"),18;break;case 6:return 20;case 7:return this.popState("escaped_text"),18;break;case 8:return 19}},"anonymous"),rules:[/^(?:sankey-beta\b)/i,/^(?:sankey\b)/i,/^(?:$)/i,/^(?:((\u000D\u000A)|(\u000A)))/i,/^(?:(\u002C))/i,/^(?:(\u0022))/i,/^(?:([\u0020-\u0021\u0023-\u002B\u002D-\u007E])*)/i,/^(?:(\u0022)(?!(\u0022)))/i,/^(?:(([\u0020-\u0021\u0023-\u002B\u002D-\u007E])|(\u002C)|(\u000D)|(\u000A)|(\u0022)(\u0022))*)/i],conditions:{csv:{rules:[2,3,4,5,6,7,8],inclusive:!1},escaped_text:{rules:[7,8],inclusive:!1},INITIAL:{rules:[0,1,2,3,4,5,6,7,8],inclusive:!0}}};return k}();r.lexer=c;function g(){this.yy={}}return m(g,"Parser"),g.prototype=r,r.Parser=g,new g}();kt.parser=kt;var nt=kt,it=[],ot=[],rt=new Map,ye=m(()=>{it=[],ot=[],rt=new Map,bt()},"clear"),me=class{constructor(t,e,s=0){this.source=t,this.target=e,this.value=s}static{m(this,"SankeyLink")}},ge=m((t,e,s)=>{it.push(new me(t,e,s))},"addLink"),xe=class{constructor(t){this.ID=t}static{m(this,"SankeyNode")}},ke=m(t=>{t=vt.sanitizeText(t,Q());let e=rt.get(t);return e===void 0&&(e=new xe(t),rt.set(t,e),ot.push(e)),e},"findOrCreateNode"),_e=m(()=>ot,"getNodes"),ve=m(()=>it,"getLinks"),we=m(()=>({nodes:ot.map(t=>({id:t.ID})),links:it.map(t=>({source:t.source.ID,target:t.target.ID,value:t.value}))}),"getGraph"),be={nodesMap:rt,getConfig:m(()=>Q().sankey,"getConfig"),getNodes:_e,getLinks:ve,getGraph:we,addLink:ge,findOrCreateNode:ke,getAccTitle:Mt,setAccTitle:St,getAccDescription:At,setAccDescription:Lt,getDiagramTitle:Nt,setDiagramTitle:Et,clear:ye},Wt=class _t{static{m(this,"Uid")}static{this.count=0}static next(e){return new _t(e+ ++_t.count)}constructor(e){this.id=e,this.href=`#${e}`}toString(){return"url("+this.href+")"}},Se={left:ht,right:pt,center:dt,justify:G},Me=m(function(t,e,s,i){let{securityLevel:r,sankey:c}=Q(),g=Tt.sankey,k;r==="sandbox"&&(k=Y("#i"+e));let o=r==="sandbox"?Y(k.nodes()[0].contentDocument.body):Y("body"),l=r==="sandbox"?o.select(`[id="${e}"]`):Y(`[id="${e}"]`),u=c?.width??g.width,_=c?.height??g.width,v=c?.useMaxWidth??g.useMaxWidth,d=c?.nodeAlignment??g.nodeAlignment,w=c?.prefix??g.prefix,N=c?.suffix??g.suffix,E=c?.showValues??g.showValues,T=i.db.getGraph(),P=Se[d],R=10;et().nodeId(y=>y.id).nodeWidth(R).nodePadding(10+(E?15:0)).nodeAlign(P).extent([[0,0],[u,_]])(T);let D=Ct(Ot);l.append("g").attr("class","nodes").selectAll(".node").data(T.nodes).join("g").attr("class","node").attr("id",y=>(y.uid=Wt.next("node-")).id).attr("transform",function(y){return"translate("+y.x0+","+y.y0+")"}).attr("x",y=>y.x0).attr("y",y=>y.y0).append("rect").attr("height",y=>y.y1-y.y0).attr("width",y=>y.x1-y.x0).attr("fill",y=>D(y.id));let S=m(({id:y,value:A})=>E?`${y}
${w}${Math.round(A*100)/100}${N}`:y,"getText");l.append("g").attr("class","node-labels").attr("font-size",14).selectAll("text").data(T.nodes).join("text").attr("x",y=>y.x0<u/2?y.x1+6:y.x0-6).attr("y",y=>(y.y1+y.y0)/2).attr("dy",`${E?"0":"0.35"}em`).attr("text-anchor",y=>y.x0<u/2?"start":"end").text(S);let C=l.append("g").attr("class","links").attr("fill","none").attr("stroke-opacity",.5).selectAll(".link").data(T.links).join("g").attr("class","link").style("mix-blend-mode","multiply"),z=c?.linkColor??"gradient";if(z==="gradient"){let y=C.append("linearGradient").attr("id",A=>(A.uid=Wt.next("linearGradient-")).id).attr("gradientUnits","userSpaceOnUse").attr("x1",A=>A.source.x1).attr("x2",A=>A.target.x0);y.append("stop").attr("offset","0%").attr("stop-color",A=>D(A.source.id)),y.append("stop").attr("offset","100%").attr("stop-color",A=>D(A.target.id))}let O;switch(z){case"gradient":O=m(y=>y.uid,"coloring");break;case"source":O=m(y=>D(y.source.id),"coloring");break;case"target":O=m(y=>D(y.target.id),"coloring");break;default:O=z}C.append("path").attr("d",xt()).attr("stroke",O).attr("stroke-width",y=>Math.max(1,y.width)),wt(void 0,l,0,v)},"draw"),Le={draw:Me},Ae=m(t=>t.replaceAll(/^[^\S\n\r]+|[^\S\n\r]+$/g,"").replaceAll(/([\n\r])+/g,`
`).trim(),"prepareTextForParsing"),Ee=m(t=>`.label {
      font-family: ${t.fontFamily};
    }`,"getStyles"),Ne=Ee,Te=nt.parse.bind(nt);nt.parse=t=>Te(Ae(t));var ui={styles:Ne,parser:nt,db:be,renderer:Le};export{ui as diagram};
